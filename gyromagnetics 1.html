<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Magnet Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: none; /* Prevents scrolling on touch devices when interacting with canvas */
        }
        canvas {
            cursor: grab;
            border-radius: 0.75rem;
            display: block;
            width: 100%;
            height: 100%;
        }
        canvas:active {
            cursor: grabbing;
        }
        .panel {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(209, 213, 219, 0.5);
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .size-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transform: translateY(-1px);
        }
        /* Custom slider styles */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto">
        <div class="flex justify-between items-start mb-2">
            <header class="text-left">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Interactive Magnet Simulation</h1>
                <p class="text-gray-600 mt-1">Click and drag magnets to see how they interact.</p>
            </header>
            
            <!-- Nerd Stats Panel -->
            <div id="stats-panel" class="panel p-3 rounded-lg shadow-md text-sm text-gray-700 font-mono w-60 flex-shrink-0 hidden sm:block">
                <h3 class="font-bold text-base mb-2 text-gray-800 border-b pb-1">System Stats</h3>
                <p>Magnets: <span id="stat-magnets" class="font-semibold text-indigo-600">0</span></p>
                <p>Kinetic Energy: <span id="stat-energy" class="font-semibold text-indigo-600">0.00</span></p>
                <p>Strongest Pole: <span id="stat-strength" class="font-semibold text-indigo-600">0</span></p>
            </div>
        </div>
        
        <!-- Scale Controls -->
        <div class="flex justify-center mb-4">
            <div class="panel p-2 rounded-xl shadow-md flex items-center gap-2">
                <span class="font-medium text-gray-700 text-sm ml-2">Scale:</span>
                <button class="size-btn btn bg-white font-semibold py-1 px-3 text-sm rounded-lg shadow active" data-scale="1">1x</button>
                <button class="size-btn btn bg-white font-semibold py-1 px-3 text-sm rounded-lg shadow" data-scale="2">2x</button>
                <button class="size-btn btn bg-white font-semibold py-1 px-3 text-sm rounded-lg shadow" data-scale="4">4x</button>
            </div>
        </div>

        <!-- Main container for canvas -->
        <div id="canvas-container" class="relative w-full aspect-video bg-white rounded-xl shadow-lg border border-gray-200">
            <canvas id="simulationCanvas"></canvas>
            
            <!-- Controls Overlay -->
            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-11/12 max-w-xl">
                 <div class="panel p-3 rounded-xl shadow-md flex flex-col sm:flex-row items-center justify-center flex-wrap gap-4">
                    <!-- Add Magnet Controls -->
                    <div class="flex items-center gap-3">
                        <button id="addNorth" class="btn bg-red-500 text-white font-bold py-2 w-12 h-10 rounded-lg shadow-md text-xl">(+)</button>
                        <button id="addSouth" class="btn bg-blue-500 text-white font-bold py-2 w-12 h-10 rounded-lg shadow-md text-xl">(-)</button>
                    </div>
                    
                    <!-- Strength Controls -->
                    <div class="flex-grow w-full sm:w-auto flex items-center gap-2">
                         <label for="strengthSlider" class="font-medium text-gray-700 text-sm whitespace-nowrap">Strength:</label>
                         <input type="range" id="strengthSlider" min="1" max="200" value="1" class="w-full">
                         <span id="strengthValue" class="font-bold text-indigo-600 w-10 text-center text-sm">1</span>
                    </div>

                     <!-- Clear Button -->
                     <button id="clear" class="btn bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md text-sm">Clear</button>
                 </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvasWrapper = document.getElementById('canvas-container');
            const canvas = document.getElementById('simulationCanvas');
            const ctx = canvas.getContext('2d');

            // --- Control elements ---
            const addNorthBtn = document.getElementById('addNorth');
            const addSouthBtn = document.getElementById('addSouth');
            const clearBtn = document.getElementById('clear');
            const strengthSlider = document.getElementById('strengthSlider');
            const strengthValue = document.getElementById('strengthValue');
            const sizeBtns = document.querySelectorAll('.size-btn');

            // --- Stats elements ---
            const statMagnets = document.getElementById('stat-magnets');
            const statEnergy = document.getElementById('stat-energy');
            const statStrength = document.getElementById('stat-strength');
            
            let magnets = [];
            let selectedMagnet = null;
            let mouse = { x: 0, y: 0, down: false };
            let offset = { x: 0, y: 0 };
            
            let simulationScale = 1; // Global scale for the simulation

            // --- Simulation Constants ---
            const FORCE_CONSTANT = 10000;
            const MAGNET_RADIUS = 20;
            const DAMPING = 0.98;

            // --- Setup and Resize ---
            function setupCanvas() {
                const parent = canvasWrapper;
                const dpr = window.devicePixelRatio || 1;
                canvas.width = parent.clientWidth * dpr;
                canvas.height = parent.clientHeight * dpr;
                canvas.style.width = `${parent.clientWidth}px`;
                canvas.style.height = `${parent.clientHeight}px`;
                ctx.scale(dpr, dpr);
            }

            const resizeObserver = new ResizeObserver(entries => {
                setupCanvas();
            });
            resizeObserver.observe(canvasWrapper);

            // --- Magnet Class ---
            class Magnet {
                constructor(x, y, strength) {
                    this.x = x;
                    this.y = y;
                    // Radius is scaled based on the global simulation scale
                    this.radius = (MAGNET_RADIUS * (1 + Math.abs(strength) / 400)) / simulationScale;
                    this.strength = strength;
                    this.vx = 0;
                    this.vy = 0;
                }

                draw() {
                    ctx.save();
                    
                    if (this.strength > 0) { // North
                         ctx.fillStyle = '#ef4444';
                         ctx.strokeStyle = '#c02626';
                    } else { // South
                         ctx.fillStyle = '#3b82f6';
                         ctx.strokeStyle = '#1e40af';
                    }
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.lineWidth = 3 / simulationScale; // Scale line width too
                    ctx.stroke();

                    ctx.fillStyle = 'white';
                    ctx.font = `bold ${this.radius * 0.8}px Inter`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(this.strength > 0 ? '+' : '-', this.x, this.y + this.radius * 0.05);

                    ctx.restore();
                }

                updatePosition() {
                    this.vx *= DAMPING;
                    this.vy *= DAMPING;
                    this.x += this.vx;
                    this.y += this.vy;
                }

                handleBounds() {
                    const viewWidth = canvas.clientWidth / (window.devicePixelRatio || 1);
                    const viewHeight = canvas.clientHeight / (window.devicePixelRatio || 1);
                    if (this.x - this.radius < 0) {
                        this.x = this.radius;
                        this.vx *= -0.7;
                    } else if (this.x + this.radius > viewWidth) {
                        this.x = viewWidth - this.radius;
                        this.vx *= -0.7;
                    }
                    if (this.y - this.radius < 0) {
                        this.y = this.radius;
                        this.vy *= -0.7;
                    } else if (this.y + this.radius > viewHeight) {
                        this.y = viewHeight - this.radius;
                        this.vy *= -0.7;
                    }
                }
            }

            // --- Interaction Logic ---
            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = (canvas.width / (window.devicePixelRatio || 1)) / rect.width;
                const scaleY = (canvas.height / (window.devicePixelRatio || 1)) / rect.height;
                let clientX, clientY;
                if (e.touches) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            }

            function handleMouseDown(e) {
                e.preventDefault();
                mouse.down = true;
                mouse = getMousePos(e);
                canvas.style.cursor = 'grabbing';
                
                for (let i = magnets.length - 1; i >= 0; i--) {
                    const magnet = magnets[i];
                    const dist = Math.hypot(mouse.x - magnet.x, mouse.y - magnet.y);
                    if (dist < magnet.radius) {
                        selectedMagnet = magnet;
                        offset.x = mouse.x - magnet.x;
                        offset.y = mouse.y - magnet.y;
                        selectedMagnet.vx = 0;
                        selectedMagnet.vy = 0;
                        return;
                    }
                }
            }
            
            function handleMouseMove(e) {
                e.preventDefault();
                if (mouse.down) {
                    mouse = getMousePos(e);
                    if (selectedMagnet) {
                        selectedMagnet.x = mouse.x - offset.x;
                        selectedMagnet.y = mouse.y - offset.y;
                        selectedMagnet.vx = 0;
                        selectedMagnet.vy = 0;
                    }
                }
            }

            function handleMouseUp(e) {
                e.preventDefault();
                mouse.down = false;
                selectedMagnet = null;
                canvas.style.cursor = 'grab';
            }

            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
            canvas.addEventListener('touchstart', handleMouseDown, { passive: false });
            canvas.addEventListener('touchmove', handleMouseMove, { passive: false });
            canvas.addEventListener('touchend', handleMouseUp);
            canvas.addEventListener('touchcancel', handleMouseUp);

            // --- Physics and Drawing Loop ---
            function updatePhysics() {
                for (let i = 0; i < magnets.length; i++) {
                    const m1 = magnets[i];
                    if (m1 === selectedMagnet) continue;

                    for (let j = i + 1; j < magnets.length; j++) {
                        const m2 = magnets[j];
                        if (m2 === selectedMagnet) continue;

                        const dx = m2.x - m1.x;
                        const dy = m2.y - m1.y;
                        const distSq = dx * dx + dy * dy;
                        const dist = Math.sqrt(distSq);
                        
                        const minDist = m1.radius + m2.radius;
                        if (dist > 0 && dist < minDist) {
                            const overlap = minDist - dist;
                            const nx = dx / dist;
                            const ny = dy / dist;
                            m1.x -= overlap / 2 * nx;
                            m1.y -= overlap / 2 * ny;
                            m2.x += overlap / 2 * nx;
                            m2.y += overlap / 2 * ny;
                            
                            const p = (m1.vx * nx + m1.vy * ny) - (m2.vx * nx + m2.vy * ny);
                            m1.vx -= p * nx;
                            m1.vy -= p * ny;
                            m2.vx += p * nx;
                            m2.vy += p * ny;
                        }

                        if (distSq > 1) {
                            const force = FORCE_CONSTANT * (m1.strength * m2.strength) / distSq;
                            const forceX = (force * dx / dist) / 100;
                            const forceY = (force * dy / dist) / 100;
                            m1.vx -= forceX;
                            m1.vy -= forceY;
                            m2.vx += forceX;
                            m2.vy += forceY;
                        }
                    }
                }
            }

            function updateAndDisplayStats() {
                const count = magnets.length;
                let totalEnergy = 0;
                let maxStrength = 0;

                magnets.forEach(magnet => {
                    const v = Math.hypot(magnet.vx, magnet.vy);
                    const mass = Math.PI * magnet.radius * magnet.radius;
                    totalEnergy += 0.5 * mass * v * v;
                    
                    if (Math.abs(magnet.strength) > maxStrength) {
                        maxStrength = Math.abs(magnet.strength);
                    }
                });

                statMagnets.textContent = count;
                statEnergy.textContent = (totalEnergy / 1000).toFixed(2);
                statStrength.textContent = maxStrength;
            }

            function gameLoop() {
                ctx.fillStyle = '#f9fafb'; // A slightly off-white background
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                updatePhysics();
                updateAndDisplayStats();

                magnets.forEach(magnet => {
                    if (magnet !== selectedMagnet) {
                        magnet.updatePosition();
                    }
                    magnet.handleBounds();
                    magnet.draw();
                });

                requestAnimationFrame(gameLoop);
            }

            // --- UI Controls ---
            function addMagnet(strength) {
                const parentWidth = canvas.clientWidth / (window.devicePixelRatio || 1);
                const parentHeight = canvas.clientHeight / (window.devicePixelRatio || 1);
                const x = Math.random() * (parentWidth - 100) + 50;
                const y = Math.random() * (parentHeight - 100) + 50;
                magnets.push(new Magnet(x, y, strength));
            }

            addNorthBtn.addEventListener('click', () => addMagnet(parseFloat(strengthSlider.value)));
            addSouthBtn.addEventListener('click', () => addMagnet(-parseFloat(strengthSlider.value)));
            clearBtn.addEventListener('click', () => { magnets = []; });
            strengthSlider.addEventListener('input', (e) => { strengthValue.textContent = e.target.value; });

            sizeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const scale = parseInt(btn.dataset.scale, 10);
                    simulationScale = scale;
                    
                    // Clear simulation and add a new magnet for the new scale
                    magnets = [];
                    const parentWidth = canvas.clientWidth / (window.devicePixelRatio || 1);
                    const parentHeight = canvas.clientHeight / (window.devicePixelRatio || 1);
                    magnets.push(new Magnet(parentWidth / 2, parentHeight / 2, parseFloat(strengthSlider.value)));

                    sizeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
            
            // --- Initial State ---
            function init() {
                setupCanvas();
                const parentWidth = canvas.clientWidth / (window.devicePixelRatio || 1);
                const parentHeight = canvas.clientHeight / (window.devicePixelRatio || 1);
                magnets.push(new Magnet(parentWidth / 2, parentHeight / 2, parseFloat(strengthSlider.value)));
                gameLoop();
            }

            init();
        });
    </script>
</body>
</html>

