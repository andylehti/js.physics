<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Orbital Model: Standard vs. Planet Nine</title>
    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: #e0e0e0;
            background-color: #00000a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        .panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.75);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        #info-panel {
            top: 20px;
            left: 20px;
            max-width: 350px;
        }
        #info-panel h1 {
            margin-top: 0;
            font-size: 1.5rem;
            color: #ffffff;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        #info-panel p {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        #legend-panel {
            bottom: 80px;
            left: 20px;
        }
        #legend-panel h2 {
            margin-top: 0;
            font-size: 1.1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-color {
            width: 20px;
            height: 4px;
            margin-right: 10px;
            border-radius: 2px;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 12px;
            z-index: 20;
        }
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background-color: #334155;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s, transform 0.2s;
            border: 1px solid #4a5568;
        }
        .button:hover {
            background-color: #475569;
        }
        .button.active {
            background-color: #0ea5e9;
            font-weight: bold;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.5);
        }
        .label {
            position: absolute;
            color: #fff;
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            transform: translate(-50%, -150%);
            white-space: nowrap;
            text-shadow: 1px 1px 2px black;
        }
        /* Dropdown Menu Styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        #planet-menu {
            display: none;
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(20, 20, 30, 0.9);
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #planet-menu label {
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            display: block;
            cursor: pointer;
            border-radius: 4px;
        }
        #planet-menu label:hover {
            background-color: #334155;
        }
        #planet-menu input {
            margin-right: 10px;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="container">
        <div id="info-panel" class="panel">
            <h1 id="model-title">Standard 8-Planet Model</h1>
            <p id="model-description">This model shows the established orbits of the eight planets. The distant Trans-Neptunian Objects (TNOs) follow scattered, unaligned paths (gray).</p>
        </div>
        
        <div id="legend-panel" class="panel">
            <h2>Path Legend</h2>
             <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #0077ff, #ff4500, #f0e68c);"></div>
                <span>Planet Orbits</span>
            </div>
             <div class="legend-item">
                <div class="legend-color" style="background-color: #cccccc;"></div>
                <span>Dwarf Planet Orbits</span>
            </div>
            <div class="legend-item tno-legend">
                <div class="legend-color" style="background-color: #555555;"></div><span>Original TNO Path</span>
            </div>
            <div class="legend-item tno-legend">
                <div class="legend-color" style="background-color: #ffffff;"></div><span>Aligned TNO Path</span>
            </div>
            <div class="legend-item tno-legend">
                <div class="legend-color" style="background-color: #ffd700;"></div><span>Gravitational Shift</span>
            </div>
        </div>

        <div id="controls">
            <button class="button active" id="btn-standard">Standard Model</button>
            <button class="button" id="btn-p9">Planet Nine Hypothesis</button>
             <div class="dropdown">
                <button class="button" id="btn-planets">Planets</button>
                <div id="planet-menu"></div>
            </div>
            <button class="button" id="btn-ui">Toggle UI</button>
        </div>
    </div>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        const planets = [];
        const dwarfPlanets = [];
        const tnoSystems = [];
        let planetNine;
        let activeModel = 'standard';
        let uiVisible = true;
        
        const ORBIT_POINTS = 256;

        // --- SCENE SETUP ---
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x00000a);
            
            const container = document.getElementById('container');
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 5000);
            camera.position.set(0, 250, 400);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.maxDistance = 2000;
            controls.minDistance = 30;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 2.5, 3000);
            scene.add(pointLight);

            createSun();
            createPlanets();
            createDwarfPlanets();
            createTnoSystems();
            createPlanetNine();
            createPlanetToggleMenu();
            
            toggleModel('standard');

            window.addEventListener('resize', onWindowResize, false);
            document.getElementById('btn-standard').addEventListener('click', () => toggleModel('standard'));
            document.getElementById('btn-p9').addEventListener('click', () => toggleModel('p9'));
            document.getElementById('btn-ui').addEventListener('click', toggleUI);
            document.getElementById('btn-planets').addEventListener('click', (event) => {
                const menu = document.getElementById('planet-menu');
                menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
                event.stopPropagation();
            });
            document.addEventListener('click', () => document.getElementById('planet-menu').style.display = 'none');
        }
        
        function createSun() {
            const geometry = new THREE.SphereGeometry(5, 32, 32); 
            const material = new THREE.MeshBasicMaterial({ color: 0xffff00 });
            const sun = new THREE.Mesh(geometry, material);
            scene.add(sun);
        }

        function createPlanets() {
            const planetData = [
                ['Mercury', 0xaaaaaa, 1, 20, 0.24], ['Venus', 0xeda359, 1.8, 30, 0.61],
                ['Earth', 0x0077ff, 2, 45, 1], ['Mars', 0xff4500, 1.5, 60, 1.88],
                ['Jupiter', 0xd2b48c, 7, 100, 11.86], ['Saturn', 0xf0e68c, 6, 150, 29.46],
                ['Uranus', 0xadd8e6, 4, 200, 84.01], ['Neptune', 0x0000ff, 3.8, 280, 164.8]
            ];
            
            planetData.forEach(([name, color, radius, distance, speed]) => {
                const planet = new THREE.Mesh(
                    new THREE.SphereGeometry(radius, 32, 32),
                    new THREE.MeshStandardMaterial({ color })
                );
                
                const orbit = createOrbitPath({ distance, color: color, opacity: 0.5 });
                
                const planetObj = { name, mesh: planet, orbit, distance, speed, angle: Math.random() * Math.PI * 2, params: { distance, eccentricity: 0, inclination: 0, periapsisAngle: 0 }};
                planets.push(planetObj);
                scene.add(planet, orbit);
                createLabel(planetObj);
                
                if (name === 'Saturn') {
                    const ring = new THREE.Mesh(
                        new THREE.RingGeometry(radius * 1.5, radius * 2.5, 64),
                        new THREE.MeshBasicMaterial({ color: 0xaaaaaa, side: THREE.DoubleSide, transparent: true, opacity: 0.6})
                    );
                    ring.rotation.x = Math.PI / 2.5;
                    planet.add(ring);
                }
            });
        }
        
        function createDwarfPlanets() {
            const dwarfPlanetData = [
                ['Ceres', 0x39ff14, 0.8, 80, 4.6, { eccentricity: 0.08, inclination: 0.18, periapsisAngle: 1.2 }],
                ['Pluto', 0xa0d2ff, 1, 350, 248, { eccentricity: 0.25, inclination: 0.3, periapsisAngle: 3.9 }]
            ];

            dwarfPlanetData.forEach(([name, color, radius, distance, speed, params]) => {
                const dwarfPlanet = new THREE.Mesh(
                    new THREE.SphereGeometry(radius, 32, 32),
                    new THREE.MeshStandardMaterial({ color })
                );
                
                params.distance = distance;
                const orbit = createOrbitPath({ ...params, color: 0xcccccc, opacity: 0.7 });
                
                const dwarfPlanetObj = { name, mesh: dwarfPlanet, orbit, speed, angle: Math.random() * Math.PI * 2, params };
                dwarfPlanets.push(dwarfPlanetObj);
                scene.add(dwarfPlanet, orbit);
                createLabel(dwarfPlanetObj);
            });
        }
        
        function createLabel(celestialBody) {
            const labelDiv = document.createElement('div');
            labelDiv.className = 'label';
            labelDiv.textContent = celestialBody.name;
            document.getElementById('container').appendChild(labelDiv);
            celestialBody.labelDiv = labelDiv;
            celestialBody.labelVisible = true;
        }

        function createTnoSystems() {
            const clusterAngle = Math.PI * 1.5;
            for (let i = 0; i < 8; i++) {
                const standardParams = {
                    distance: 380 + Math.random() * 150, eccentricity: 0.5 + Math.random() * 0.4,
                    inclination: (Math.random() - 0.5) * 0.8, periapsisAngle: Math.random() * Math.PI * 2,
                    speed: 400 + Math.random() * 200
                };
                const p9Params = {
                    distance: 450 + Math.random() * 200, eccentricity: 0.7 + Math.random() * 0.2,
                    inclination: 0.3 + (Math.random() - 0.5) * 0.2, periapsisAngle: clusterAngle + (Math.random() - 0.5) * 0.25,
                    speed: 500 + Math.random() * 250
                };
                const standardOrbit = createOrbitPath({ ...standardParams, color: 0x555555, opacity: 0.7 });
                const p9Orbit = createOrbitPath({ ...p9Params, color: 0xffffff, opacity: 0.9 });
                const divergenceLines = createDivergenceLines(standardOrbit.geometry.attributes.position.array, p9Orbit.geometry.attributes.position.array);
                const mesh = new THREE.Mesh( new THREE.SphereGeometry(1.0, 16, 16), new THREE.MeshStandardMaterial({ color: 0xffffff }));
                const tnoSystem = { mesh, standardOrbit, p9Orbit, divergenceLines, standardParams, p9Params, angle: Math.random() * Math.PI * 2 };
                tnoSystems.push(tnoSystem);
                scene.add(mesh, standardOrbit, p9Orbit, divergenceLines);
            }
        }

        function createPlanetNine() {
            const p9Params = {
                distance: 700, eccentricity: 0.6, inclination: 0.4,
                periapsisAngle: Math.PI * 0.5, speed: 2000
            };
            planetNine = {
                mesh: new THREE.Mesh( new THREE.SphereGeometry(8, 32, 32), new THREE.MeshStandardMaterial({ color: 0x5a6a8a })),
                orbit: createOrbitPath({ ...p9Params, color: 0x5a6a8a, opacity: 1.0 }),
                params: p9Params, angle: 0
            };
            scene.add(planetNine.mesh, planetNine.orbit);
        }

        function createOrbitPath({ distance, color, opacity, eccentricity = 0, inclination = 0, periapsisAngle = 0 }) {
            const semiMajorAxis = distance;
            const semiMinorAxis = semiMajorAxis * Math.sqrt(1 - eccentricity * eccentricity);
            const centerOffsetX = -semiMajorAxis * eccentricity;
            const curve = new THREE.EllipseCurve(centerOffsetX, 0, semiMajorAxis, semiMinorAxis, 0, 2 * Math.PI, false, 0);
            const points = curve.getPoints(ORBIT_POINTS);
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({ color, transparent: true, opacity });
            const orbitLine = new THREE.Line(geometry, material);
            const euler = new THREE.Euler(inclination, periapsisAngle, 0, 'YXZ');
            orbitLine.setRotationFromEuler(euler);
            return orbitLine;
        }

        function createDivergenceLines(points1, points2) {
            const vertices = [];
            for (let i = 0; i < points1.length; i += 3) {
                vertices.push(points1[i], points1[i+1], points1[i+2]);
                vertices.push(points2[i], points2[i+1], points2[i+2]);
            }
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.LineDashedMaterial({ color: 0xffd700, linewidth: 1, scale: 1, dashSize: 3, gapSize: 3, transparent: true, opacity: 0.6 });
            const lines = new THREE.LineSegments(geometry, material);
            lines.computeLineDistances();
            return lines;
        }

        function createPlanetToggleMenu() {
            const menu = document.getElementById('planet-menu');
            const allPlanets = [...planets, ...dwarfPlanets];

            allPlanets.forEach(p => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = true;
                checkbox.dataset.name = p.name;

                checkbox.addEventListener('change', (event) => {
                    const planetName = event.target.dataset.name;
                    const isVisible = event.target.checked;
                    const planetToToggle = allPlanets.find(pl => pl.name === planetName);
                    if (planetToToggle) {
                        planetToToggle.labelVisible = isVisible;
                    }
                });

                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(p.name));
                menu.appendChild(label);
            });
             menu.addEventListener('click', (event) => event.stopPropagation());
        }
        
        // --- ANIMATION AND LOGIC ---
        function animate() {
            requestAnimationFrame(animate);
            const allCelestialBodies = [...planets, ...dwarfPlanets];
            allCelestialBodies.forEach(p => {
                p.angle += (1 / p.speed) * 0.1;
                const pos = calculateEllipsePosition(p.angle, p.params);
                p.mesh.position.copy(pos);
            });

            tnoSystems.forEach(system => {
                const params = (activeModel === 'standard') ? system.standardParams : system.p9Params;
                system.angle += (1 / params.speed) * 0.05;
                const position = calculateEllipsePosition(system.angle, params);
                system.mesh.position.copy(position);
            });
            
            if (planetNine.mesh.visible) {
                 planetNine.angle += (1 / planetNine.params.speed) * 0.1;
                 const pos = calculateEllipsePosition(planetNine.angle, planetNine.params);
                 planetNine.mesh.position.copy(pos);
            }
            
            updateLabels();
            controls.update();
            renderer.render(scene, camera);
        }
        
        function updateLabels() {
            const allPlanets = [...planets, ...dwarfPlanets];
            allPlanets.forEach(p => {
                if (!p.labelVisible) {
                    p.labelDiv.style.display = 'none';
                    return;
                }
                const vec = new THREE.Vector3();
                p.mesh.getWorldPosition(vec);
                vec.project(camera);
                const x = (vec.x * 0.5 + 0.5) * renderer.domElement.clientWidth;
                const y = (-vec.y * 0.5 + 0.5) * renderer.domElement.clientHeight;

                if (vec.z > 1) {
                    p.labelDiv.style.display = 'none';
                } else {
                    p.labelDiv.style.display = 'block';
                    p.labelDiv.style.left = `${x}px`;
                    p.labelDiv.style.top = `${y}px`;
                }
            });
        }

        function calculateEllipsePosition(angle, { distance, eccentricity, inclination, periapsisAngle }) {
            const a = distance;
            const e = eccentricity;
            const b = a * Math.sqrt(1 - e * e);
            const x = a * Math.cos(angle) - a * e;
            const z = b * Math.sin(angle);
            const pos = new THREE.Vector3(x, 0, z);
            const euler = new THREE.Euler(inclination, periapsisAngle, 0, 'YXZ');
            pos.applyEuler(euler);
            return pos;
        }

        function onWindowResize() {
            const container = document.getElementById('container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function toggleUI() {
            uiVisible = !uiVisible;
            document.getElementById('info-panel').style.opacity = uiVisible ? '1' : '0';
            document.getElementById('legend-panel').style.opacity = uiVisible ? '1' : '0';
            document.getElementById('btn-ui').classList.toggle('active', uiVisible);
        }

        function toggleModel(model) {
            activeModel = model;
            const isStandard = model === 'standard';

            tnoSystems.forEach(system => {
                system.standardOrbit.visible = true;
                system.p9Orbit.visible = !isStandard;
                system.divergenceLines.visible = !isStandard;
                system.mesh.material.color.set(isStandard ? 0x999999 : 0xffffff);
            });
            
            planetNine.mesh.visible = !isStandard;
            planetNine.orbit.visible = !isStandard;
            
            document.querySelectorAll('.tno-legend').forEach(el => {
                el.style.display = isStandard ? 'none' : 'flex';
            });
            document.getElementById('btn-standard').classList.toggle('active', isStandard);
            document.getElementById('btn-p9').classList.toggle('active', !isStandard);
            
            const title = document.getElementById('model-title');
            const desc = document.getElementById('model-description');
            if (isStandard) {
                title.textContent = "Standard Model";
                desc.innerHTML = "This model shows the known planets and dwarf planets. The distant Trans-Neptunian Objects (TNOs) follow their current, <b>scattered and random</b> orbits (gray paths).";
            } else {
                title.textContent = "Planet Nine Hypothesis";
                desc.innerHTML = "Planet Nine's gravity realigns the TNOs from their original paths (gray) into <b>new, clustered orbits (white)</b>. The yellow lines show this gravitational shift, explaining the observed alignment.";
            }
        }

        init();
        animate();
    </script>
</body>
</html>

